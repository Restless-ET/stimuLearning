<?php

/**
 * Scenario
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    stimuLearning
 * @subpackage model
 * @author     Artur Melo <adsmelo@ua.pt>
 */
class Scenario extends BaseScenario
{
    /**
     * Takes the necessary steps to initialize all data regarding the simulation starting point (time=0)
     *
     * @return true on success, error message otherwise
     */
    public function initializeSimulation()
    {
        $msg = true;
        // validate that this scenario has operators
        if (!count($scenario->Operators)) {
            $msg = 'This scenario has no associated operators!';
        }

        // validate that services exists for all operators
        foreach ($scenario->Operators as $operator) {
            if (!count($operator->Services)) {
                $msg = 'One or more of the Operators does not have any Service registered yet!';
                break;
            }

            //TODO Calculate the initial equipments that are necessary and acquire them.

            //TODO Create the initial tick (Equipments price is for CAPEX; costs_per_user for OPEX; setup_fee???)
        }

        //TODO Init a market tick

        if ($msg === true) {
            // Change scenario to started
            $this->setStarted(true);
            $this->save();
        }

        return $msg;
    }

    /**
     * Advances the scenario simulation to the next step.
     *
     * @return void
     */
    public function advanceToNextStep()
    {
        foreach ($scenario->Operators as $operator) {

            //TODO Determine the how many clients have arrived/left for the operator

            //TODO Calculate the necessary equipments and acquire them.

            //TODO Create the ticks (Equipments price is for CAPEX; costs_per_user for OPEX)
        }

        //TODO A new market tick??
    }
}
